<?xml version="1.0"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), EnlistmentInfo.props))\EnlistmentInfo.props" Condition=" '$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), EnlistmentInfo.props))' != '' " />

  <PropertyGroup>
    <NuPkgContentLayoutPath>$(BaseIntermediateOutputPath)</NuPkgContentLayoutPath>
    <CopyBuildOutputToOutputDirectory>false</CopyBuildOutputToOutputDirectory>
    <CopyOutputSymbolsToOutputDirectory>false</CopyOutputSymbolsToOutputDirectory>
    <NoDocumentationFile>true</NoDocumentationFile>
    <NuGetToolPath>$(NuGetPackageRestorePath)NuGet.CommandLine.2.8.3\tools\NuGet.exe</NuGetToolPath>
    <NuSpecFile>VS.ExternalAPIs.VSPlatform.Validation.nuspec</NuSpecFile>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\src\Microsoft.VisualStudio.Validation\Microsoft.VisualStudio.Validation.csproj" />
  </ItemGroup>

  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), EnlistmentInfo.targets))\EnlistmentInfo.targets" Condition=" '$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), EnlistmentInfo.targets))' != '' " />

  <Target Name="Build" DependsOnTargets="GetBuildVersion">
    <MSBuild Projects="@(ProjectReference)"
             Targets="DocumentationProjectOutputGroup">
      <Output TaskParameter="TargetOutputs" ItemName="DocFile"/>
    </MSBuild>
    <MSBuild Projects="@(ProjectReference)"
             Targets="Build">
      <Output TaskParameter="TargetOutputs" ItemName="AssemblyFile"/>
    </MSBuild>
    <Copy SourceFiles="@(AssemblyFile);@(DocFile)" DestinationFolder="$(NuPkgContentLayoutPath)" />
    <Exec Command='"$(NuGetToolPath)" pack "$(NuSpecFile)" -NoPackageAnalysis -BasePath "$(NuPkgContentLayoutPath)\" -Version "$(NuGetPackageVersion)" -OutputDirectory "$(OutputPath)\" ' />
    <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(NuGetFeedLocation)"
          Condition=" '$(NuGetFeedLocation)' != '' "/>
  </Target>
</Project>